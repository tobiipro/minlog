{"version":3,"sources":["../../src/serializers/err.ts"],"names":[],"mappings":"2HAAA,2E;;;;;;;AAOO,IAAI,YAAY,GAAG,YAA6B;AACrD,SAAO,gBAAe,EAAC,KAAD,EAAf,EAAwB;AAC7B,QAAI;AACF,MAAA,GADE;AAEA,IAAA,KAFJ;;AAIA,QAAI,CAAC,yBAAE,OAAF,CAAU,GAAV,CAAL,EAAqB;AACnB,aAAO,KAAP;AACD;;AAED,QAAI,KAAK,GAAG,yBAAE,KAAF,CAAQ,yBAAE,SAAF,CAAY,GAAG,CAAC,KAAhB,EAAuB,EAAvB,CAAR,EAAoC,IAApC,CAAZ;AACA,IAAA,KAAK,GAAG,yBAAE,OAAF,CAAU,KAAV,IAAmB,SAAnB,GAA+B,KAAvC;;AAEA,IAAA,KAAK,CAAC,GAAN,GAAY,yBAAE,IAAF,CAAO,GAAP,EAAY;AACtB,UADsB;AAEtB,aAFsB;AAGtB;AACA,cAJsB;AAKtB,eALsB,CAAZ,CAAZ;;AAOA,IAAA,KAAK,CAAC,GAAN,CAAU,KAAV,GAAkB,KAAlB;;AAEA,QAAI,WAAW,GAAG,KAAK,CAAC,GAAN,CAAU,QAAV,GAAqB,WAArB,GAAmC,EAArD;AACA,QAAI,YAAY,GAAG,KAAK,CAAC,GAAN,CAAU,SAAV,GAAsB,eAAtB,GAAwC,EAA3D;AACA,QAAI,GAAG,GAAG,yBAAE,WAAF,CAAc,KAAK,CAAC,GAAN,CAAU,KAAxB;AACP,OAAE,KAAK,CAAC,GAAN,CAAU,IAAK,KAAI,KAAK,CAAC,GAAN,CAAU,OAAQ,EADhC;AAER,6BAAE,IAAF,CAAO,KAAK,CAAC,GAAN,CAAU,KAAjB,EAAwB,IAAxB,CAFF;AAGA,IAAA,GAAG,GAAI,GAAE,WAAY,GAAE,YAAa,GAAE,GAAI,EAA1C;AACA,IAAA,KAAK,CAAC,GAAN,GAAY,yBAAE,SAAF,CAAY,KAAK,CAAC,GAAlB,EAAuB,GAAvB,CAAZ;;AAEA,WAAO,KAAP;AACD,GA9BD;AA+BD,CAhCM,C","file":"err.js","sourcesContent":["import _ from 'lodash-firecloud';\n\nimport {\n  MinLogSerializedError,\n  MinLogSerializer\n} from '../types';\n\nexport let serializeErr = function(): MinLogSerializer {\n  return async function({entry}) {\n    let {\n      err\n    } = entry;\n\n    if (!_.isError(err)) {\n      return entry;\n    }\n\n    let stack = _.split(_.defaultTo(err.stack, ''), '\\n');\n    stack = _.isEmpty(stack) ? undefined : stack;\n\n    entry.err = _.pick(err, [\n      'name',\n      'message',\n      // custom\n      'uncaught',\n      'inPromise'\n    ]) as MinLogSerializedError;\n    entry.err.stack = stack;\n\n    let uncaughtMsg = entry.err.uncaught ? 'Uncaught ' : '';\n    let inPromiseMsg = entry.err.inPromise ? '(in promise) ' : '';\n    let msg = _.isUndefined(entry.err.stack) ?\n      `${entry.err.name}: ${entry.err.message}` :\n      _.join(entry.err.stack, '\\n');\n    msg = `${uncaughtMsg}${inPromiseMsg}${msg}`;\n    entry.msg = _.defaultTo(entry.msg, msg);\n\n    return entry;\n  };\n};\n\nexport default serializeErr;\n"]}